#!/usr/bin/env ruby

# this will require rfeed.rb in a clever way
require "#{File.dirname(__FILE__)}/../lib/rfeed.rb"
require "pp"

SUB_COMMANDS = %w/feed post add new/

raise ArgumentError, "Sin comando" unless ARGV[0]

cmd = ARGV.shift
case cmd
	when "fetch"
		if ARGV[0]
			fs = Feed.find ARGV[0]
			fs.fetch
		else
			fs = Feed.find :all
			fs.each do |f|
				f.fetch
			end
		end

	when "post"
	when "new"
		raise ArgumentError, "No feed specified" unless ARGV[0]
		f =	Feed.new :feed => ARGV[0]
		if f.save
			puts "Successfully subscribed: #{f.id}:#{f.feed_url}"
		else
			unless f.errors.full_messages.empty?
				$stderr.puts "ERROR:"
				f.errors.full_messages.each do |e|
					$stderr.puts " #{e}"
				end
			end
		end

	when /(del|delete|remove)/i
		raise ArgumentError, "No feed id specified to remove" unless ARGV[0]
		f = Feed.find ARGV[0]
		if f.destroy
			puts "#{f.name} successfully deleted."
		else
			$stderr.puts "ERROR:"
			f.errors.full_messages.each do |e|
				$stderr.puts " #{e}"
			end
		end


	when "list"
		fs = Feed.find :all
		fs.each do |f|
			puts "#{ f.id}:#{f.feed_url}"
			pp f
		end
	
	when /^\d+$/
		f = Feed.find cmd
		pp f

	else
		raise ArgumentError, "No comand found for `#{cmd}'"
end


